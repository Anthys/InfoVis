<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<style type="text/css" media="screen, print">
		</style>
		<title>Co2 Greenhouse Gas Emissions</title>
	</head>
    <body>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<!--TODO REPLACE BY LOCAL D3-->
<div id="regions_div" style="width: 900px; height: 500px;"></div>
<script>
    google.charts.load('current', {
        'packages':['geochart'],
      });
      google.charts.setOnLoadCallback(drawRegionsMap);

      function drawRegionsMap() {

      d3.tsv("/course_files/data/owid-co2-data.tsv")
      .row(
        d => ({
          country:   d['#country'],
          iso3:      d.iso_code,
          co2:      +d.co2,
          trade_co2: +d.trade_co2,
          co2_per_capita: +d.co2_per_capita,
          year:     +d.year,
          population: +d.population,
	      }))
      .get(function(data){
        data = data.filter(d => {return (d.year == 2019);});
        console.log(data);
        // data = data.map(d=>([d.country, 1_000_000*d.co2/d.population]));
        data = data.map(d=>([d.country, d.co2_per_capita]));

        data = [["Country", "co2Emission/capita (ton/hab)"]].concat(data);
        data = google.visualization.arrayToDataTable(data);

        var options = {
          colorAxis:{minValue:0, maxValue:27}
        };

        var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));

        chart.draw(data, options);
      });
      }
</script>
</body>
</html>